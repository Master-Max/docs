******
4.11.4
******

==================================
Новая функциональность и улучшения
==================================

[+] Внешний вид: Бренды: Добавлена возможность ограничить количество брендов, выводимых в блоке "Бренды".

[+] Модули: SEO: Для товаров добавлена микроразметка JSON-LD.

[+] Модули: Вариации товаров: Добавлен API для работы с вариациями.

[+] Модули: Вариации товара: Добавлены уведомления о необходимости пересохранить товары после изменения настроек модуля.

[+] Модули: Поиск от Searchanise: Добавлена поддержка модулей “Вариации товаров” и “Общие товары для продавцов”.

[+] Модули: Российские способы оплаты: Robokassa: Добавлена возможность формировать чек зачета предоплаты для соответствия 54-ФЗ.

[+] Модули: Склады [Beta]: Теперь модуль корректно работает с несколькими витринами.

[+] Пользователи: Покупатели: На страницу редактирования покупателя в панели администратора добавлена дата регистрации и другая полезная информация.

[+] Способы оплаты: Переорганизован список процессоров.

[+] Документы: Детали заказа, Счёт: В документы добавлена ссылка на информацию о товаре.

[+] Товары: Опции: Добавлена возможность массового удаления опций.

[+] Multi-Vendor: Модули: Магазины и пункты самовывоза: На витрине добавлена фильтрация по продавцам для списка магазинов и пунктов самовывоза.

[+] Multi-Vendor Plus: Модули: Мобильное приложение: Добавлена возможность редактировать переводы мобильного приложения в панели администратора.

[+] Multi-Vendor Ultimate: Модули: Способы оплаты в зависимости от страны: Добавлен новый модуль для введения зависимости метода оплаты от страны из которой покупатель.


=========================================
Изменения в существующей функциональности
=========================================

[*] Визуальные редакторы: TinyMCE: Добавлено выравнивание по ширине (align: justify).

[*] Заказы: Статус "Незавершенный" теперь можно выбрать при редактировании заказа в панели администратора.

[*] Модули: Поставщики: Для каждого статуса заказа был добавлен отдельный шаблон почтового уведомления для поставщика.

[*] Модули: Российские способы оплаты: Добавлена языковая переменная для печати счета Сбербанка.

[*] Модули: CommerceML: Добавлена поддержка выгрузки товарных предложений в вариации для схемы импорта 2.07.

[*] Модули: Searchanise: Теперь модуль корректно работает с модулем "Вариации товаров" (CS-Cart, Multi-Vendor) и с модулем "Общие товары для продавцов" (Multi-Vendor).

[*] Панель администратора: Теперь названия пунктов меню "Покупатели", "Товары" и "Продавцы" находятся в отдельных языковых переменных.

[*] Поиск: Теперь поиск на витрине магазина выполняется по всем словам в запросе, а не по точной фразе.

[*] Промо-акции: Для условия "Характеристика товара" добавлен поиск характеристики.

[*] Режим виджета: Упоминания виджета убраны из интерфейса.

[*] Способы доставки: Уведомления: Теперь вы можете отключить E-mail уведомления об ошибках способа доставки в Администрирование > Уведомления, даже если включена запись в Журнал событий об Ошибках доставки, рассчитываемой в режиме реального времени, в Настройки > Журнал событий.

[*] Multi-Vendor: Модули: Магазины и пункты самовывоза: Теперь поиск позволяет вводить имя продавца и показывает предположения.

[*] Multi-Vendor: Модули: Премодерация данных продавцов: В меню "Продавцы" добавился раздел "Модерация".

[*] Multi-Vendor: Пользователи: Администраторы продавцов: Улучшен поиск администраторам по продавцам, к которым они относятся.

[*] Multi-Vendor: Продавцы: Логотипы: Теперь логотипом по умолчанию для продавцов будет логотип маркетплейса, а не логотип темы.

[*] Multi-Vendor Plus: Модули: Общие товары для продавцов: Блоки: Теперь при добавлении товара в блок отображается его владелец.


==================
Исправления ошибок
==================

[!] Блоки: Кэш: Если для блока определен пользовательский класс, то такой блок отображался, даже если его контент пуст. Исправлено.

[!] Визуальный редактор: Redactor II: Когда выполнялось вставка таблицы, то границы не отображались. Исправлено.

[!] Витрины: Регионы: Возникали ошибки PHP Notice при редиректах между витринами. Исправлено.

[!] Витрины: Когда все витрины были закрыты, ссылка на иконке корзины в левом верхнем углу панели администратора вела на список компаний. Теперь ссылка ведет на первую закрытую витрину. Исправлено.

[!] Дизайн: Выбор диапазона дат: Автозаполнение перекрывало календарь. Исправлено.

[!] Дизайн: Изображения: При удалении изображения товара оно не пропадало до перезагрузки страницы. Исправлено.

[!] Дизайн: Не выполнялась прокрутка страницы в мобильной версии, если палец попадал на изображение. Исправлено.

[!] Дизайн: Редактор тем: Пользовательский CSS обрезался, если он включал HTML-теги. Исправлено.

[!] Дизайн: Редактор темы: Режим "Редактор текста" работал некорректно и показывал "NaN (Not a number)" вместо сохранённого текста. Исправлено.

[!] Дизайн: Тема Responsive: Подвал: У иконок способов оплаты не было отступов. Исправлено.

[!] Дизайн: Характеристики товара: Если у бренда не было изображения, то он отображался некорректно. Исправлено.

[!] Заказы: Отчеты о продажах: В воскресенье строился неправильный интервал времени в отчетах по неделям. Исправлено.

[!] Карты и геолокация: Карту Google нельзя было перемещать двумя пальцами. Исправлено.

[!] Категории: Вариации: Позиция вариаций в категории не синхронизировалась после изменения позиции вариации по умолчанию. Исправлено.

[!] Корзина: В окне "Рассчитать стоимость доставки" пропадал заголовок при повторном открытии окна. Исправлено.

[!] Макеты: В некоторых случаях блоки страницы макета "По умолчанию" были доступны для удаления и редактирования на странице редактирования объекта (товара, страницы...) на вкладке "Макеты". Исправлено.

[!] Модули: Блог: Список постов не отображался для витрины, если посты были сделаны общими для двух витрин, но эта витрина не являлась владельцем. Исправлено.

[!] Модули: Бонусные баллы: Покупателю начислялось неверное количество бонусных баллов за заказ, если он купил несколько штук одного и того же товара со скидкой. Исправлено.

[!] Модули: Вариации товаров: Дизайн: У характеристики с внешним видом "Изображения" название варианты переносилось на следующую строку. Исправлено.

[!] Модули: Вариации товаров: Название дочерних вариаций бралось от первой вариации, а не от вариации по умолчанию. Исправлено.

[!] Модули: Вариации товаров: Популярность вариаций отличалась от значения популярности вариации по умолчанию. Исправлено.

[!] Модули: Вариации товаров: Поиск товаров в списке заказов не отображал вариации. Исправлено.

[!] Модули: Вариации товаров: Сортировка: При фильтрации вариации некорректно сортировались по размеру скидки. Исправлено.

[!] Модули: Вариации товаров: Экспорт/Импорт: Импорт товара, который был пропущен как обновляемый при стратегии "Создать только новые товары", приводил к расформированию группы вариаций. Исправлено.

[!] Модули: Видео-помощь: Кнопка "Посмотреть, как это работает" не работала, и видео не открывалось. Исправлено.

[!] Модули: Возврат товаров: Информация о запросах на возврат копировалась в новый заказ при копировании заказа. Исправлено.

[!] Модули: Вход через соцсети: Авторизация через PayPal не работала. Исправлено.

[!] Модули: Города: СДЭК: Boxberry: Неправильно отображался регион для города Троицк. Исправлено.

[!] Модули: Города: Служба доставки — СДЭК: Почта России: Доставка Почтой России была не доступна для города Ростов-на-Дону. Исправлено.

[!] Модули: Деловые Линии: Сообщение об ошибке при тестовом расчёте стоимости не отображало информацию, нужную для решения проблемы. Исправлено.

[!] Модули: Зависимости для способов оплаты: Промоакции: Если была создана промоакция для способа оплаты, то стоимость заказа не обновлялась после переключения способа доставки. Исправлено.

[!] Модули: Карта сайта для Yandex и Google:  Вариации товаров: В sitemap.xml попадали ссылки без SEO-имени. Fixed.

[!] Модули: Карта сайта для Yandex и Google: В сгенерированной карте сайта мог использоваться не тот язык в URL'ах. Исправлено.

[!] Модули: Карты и геолокация: Boxberry: Стоимость доставки Boxberry неверно отображалась на карточке товара. Исправлено.

[!] Модули: Комбинации товаров: Нельзя было оформить заказ на комбинацию товаров повторно. Исправлено.

[!] Модули: Ограничение доступа: Когда сервер с установкой находится за прокси, могли возникать ошибки записи в БД. Исправлено

[!] Модули: ПЭК: Сервер ПЭК не мог связаться с магазином. Исправлено.

[!] Модули: Платежи через PayPal: В магазинах с несколькими витринами на странице корзины могли выводиться лишние кнопки "Оплатить через PayPal". Исправлено.

[!] Модули: Платежи через PayPal: В PayPal могла передаваться неправильная стоимость доставки при использовании FedEx или DHL. Исправлено.

[!] Модули: Поставщики: Витрины: Если в магазине было несколько витрин, то назначенный для способа доставки поставщик сбрасывался при сохранении способа доставки в режиме "Все витрины". Исправлено.

[!] Модули: Прайс-лист: Склады: Если остатки товара были разделены по складам, то в прайс-лист выгружалось неверное количество товара. Исправлено.

[!] Модули: Рассылки: "Email отправителя" и "Email для ответа" из настроек списка рассылки не использовались. Исправлено.

[!] Модули: Рассылки: Привилегии: Администратор мог изменять статус рассылок, не имея на это доступа. Исправлено.

[!] Модули: Расширенный импорт товаров: При удалении пресетов файлы, на основе которых был сделан пресет, оставались в домашней директории компании. Исправлено.

[!] Модули: Расширенный импорт товаров, Обратный звонок, Рассылки, Служба доставки — СДЭК, АТОЛ Онлайн, Поиск от Searchanise: При установке модулей после восстановления магазина возникали ошибки. Исправлено.

[!] Модули: Расширенный импорт товаров: Некорректно импортировались товары с десятичными дробями в Box size. Исправлено.

[!] Модули: Российские способы оплаты: Покупатель мог оказаться разлогиненным после возврата с сайта Робокассы. Исправлено.

[!] Модули: Склады [Beta]: Не учитывалось кол-во товара на складе в списках товаров; таким образом, товар мог отображаться как доступный, даже если он не был доступен для текущей локации покупателя. Исправлено.

[!] Модули: Склады [Beta]: Расширенный импорт товаров: Если идентификатор склада совпадал с любым идентификатором характеристики товара, то склад не мог быть сопоставлен в таблице соответствия полей пресета. Исправлено.

[!] Модули: Склады [Beta]: Товар с отрицательным количеством на складе показывался как "В наличии" на вкладке товара "Наличие в магазинах". Исправлено.

[!] Модули: СДЭК: В базе СДЭК не было кода города Нур-Султан (Астана).

[!] Модули: СДЭК: Поиск по точкам самовывоза на странице оформления заказа не работал. Исправлено.

[!] Модули: Чат с продавцом: Оповещение по email содержало неправильный текст и тему, если сообщение было написано администратором. Исправлено.

[!] Модули: Экспорт в Яндекс.Маркет: Генерация прайс-листа из консоли всегда генерировала прайс-лист первой витрины. Исправлено.

[!] Модули: Экспорт в Яндекс.Маркет: Неверно определялся тип товарного предложения, если он наследовал значение типа от категории, а в магазине было много категорий. Исправлено.

[!] Модули: Яндекс.Доставка: Не работала сортировка точек самовывоза. Исправлено.

[!] Модули: Яндекс.Касса: Сумма заказа конвертировалась неверно, если её валюта отличалась от валюты, указанной в настройках способа оплаты. Исправлено.

[!] Модули: Яндекс.Касса: Поступали повторные уведомления об оплате заказа. Исправлено.

[!] Модули: Яндекс.Касса: Чек полной оплаты мог выписываться несколько раз при ручной смене статуса заказа. Исправлено.

[!] Модули: CommerceML: Склады [Beta]: Возникали ошибки PHP Warning и Notice при импорте товаров с использованием складов. Исправлено.

[!] Модули: CommerceML: Статус заказа мог обновиться для заказа не с тем ID. Исправлено.

[!] Модули: CommerceML: Товар, у которого было только одно товарное предложение, не импортировался как группа вариаций. Исправлено.

[!] Модули: SEO: Хиты продаж и товары со скидкой: На страницах модуля "Хиты продаж и товары со скидкой" были неправильные canonical-ссылки. Исправлено.

[!] Модули: Unisender: Ошибка в процессе подписки на рассылку на витрине вызывала PHP Notice. Исправлено.

[!] Мультивитринность: Дизайн: Макеты: Если к моменту сохранения данных блока в другой вкладке была выбрана другая витрина, то такой блок пропадал из макета. Исправлено.

[!] Мультивитринность: Управление товарами: Если к моменту сохранения товара в другой вкладке была выбрана другая витрина или язык, то данные этого товара сохранялись не для той витрины или языка. Исправлено.

[!] Настройки: Кэш: Новые значения для настроек витрины не применялись без очистки кеша. Исправлено.

[!] Опции товаров: При создании заказа в панели администратора отображались выключенные опции. Исправлено.

[!] Отчеты о продажах: На мониторах с высоким разрешением не подгружались товары в отчетах. Исправлено.

[!] Оформление заказа: Адрес: Заголовок блока адреса отображался всегда, даже если адрес вводить не требовалось. Исправлено.

[!] Оформление заказа: При попытке ввести значение в поле "Страна" после ввода первого символа фокус переходил на следующее поле. Исправлено.

[!] Оформление заказа: Заказы: Поля профиля: При определенной настройке отображения полей профиля, имя и фамилия пользователя могли быть обрезаны в заказе. Исправлено.

[!] Оформление заказа: Некоторые данные из секции "Адрес плательщика" сохранялись в заказе, даже если заказ оформлялся с выключенной галкой "Я оформляю заказ как юридическое лицо". Исправлено.

[!] Панель администратора: Заказы: Счет PDF: Повторная массовая печать счета (PDF) не выполнялась без перезагрузки страницы. Исправлено.

[!] Пользователи: Сортировка по дате последнего входа не работала на списке пользователей в панели администратора. Исправлено.

[!] Пользователи: Телефон: Маска телефонов Австрии не поддерживалась. Исправлено.

[!] Привилегии: Уведомления: Доступ к управлению уведомлениями не мог быть ограничен. Исправлено.

[!] Редактор тем: Стиль с пробелами в названии нельзя было удалить. Исправлено.

[!] Редактор тем: Оформление заказа: Несколько профилей: Не было возможности изменить цвета выбора профиля. Исправлено.

[!] Редактор файлов: Не появлялось окно загрузки. Исправлено.

[!] Способы доставки: Canada Post: Служба доставки Expedited Parcel не работала. Исправлено.

[!] Способы доставки: Модули: Калькулятор стоимости доставки eDost.ru: Выбранный пункт самовывоза Pickpoint сбрасывался после выбора способа оплаты и не сохранялся в информации о заказе. Исправлено.

[!] Способы доставки: Сохранение способа доставки со страницы со списком способов доставки могло удалить время доставки у каждой тарифной зоны этого способа доставки. Исправлено.

[!] Способы оплаты: Модули: Российские способы оплаты: Плати дома: Вырезан устаревший способ оплаты.

[!] Товары: Изображения: Если между добавлением alt-текста и сохранением удалить какое-нибудь изображение, то пропадал и добавленный alt-текст. Исправлено.

[!] Товары: Недоступные комбинации: Не было возможности добавить еще одну запрещенную комбинацию опций к товару, если в списке уже есть записи. Исправлено.

[!] Товары: Поиск: Фильтры товаров показывались даже при отсутствии результатов поиска. Исправлено.

[!] Товары: Характеристики товара: Значение варианта с кавычками отображалось в виде спецсимволов HTML в названии товара. Исправлено.

[!] Уведомления: Ссылка на скачивание цифрового товара в электронном письме могла вести на неправильную витрину. Исправлено.

[!] Уведомления: Уведомление отображалось под кнопкой "ПОСМОТРЕТЬ, КАК ЭТО РАБОТАЕТ". Исправлено.

[!] Ядро: JS: На PHP 7.3 возникали предупреждения при сборке javascript. Исправлено.

[!] Ядро: Пользователи: Поиск по полному имени мог работать неправильно. Исправлено.

[!] Email-уведомления: ссылка на сброс пароля вела на главную страницу магазина. Исправлено.

[!] Multi-Vendor: Модули: Подтверждение на обработку персональных данных (152-ФЗ): Не отображались данные о компании в языковых переменных. Исправлено.

[!] Multi-Vendor: Дизайн: Страница оформления заказа: Макет страницы был неверный. Исправлено.

[!] Multi-Vendor: Модули: Тарифные планы для продавцов: При регистрации вендора через витрину мог быть доступен тарифный план, недоступный на этой витрине. Исправлено.

[!] Multi-Vendor: Покупатели: Для администратора продавца отображалось действие "Удалить покупателя", несмотря на то, что продавцы не могут это делать. Исправлено.

[!] Multi-Vendor: Продавцы: В каталоге компаний при включенном модуле "Отзывы и комментарии" при сортировке компаний по рейтингу, компании с нулевым рейтингом не попадали в список. Исправлено.

[!] Multi-Vendor: Продавцы: При определенных условиях создание нового продавца не позволяло создать ему администратора автоматически. Исправлено.

[!] Multi-Vendor: Фильтры товаров: Блок с фильтрами товаров показывал продавцов, которые не относятся к текущей витрине. Исправлено.

[!] Multi-Vendor: E-mails: В нижней части письма, отправляемого продавцу, могла быть информация самого продавца, а не маркетплейса. Исправлено.

[!] Multi-Vendor Plus: Модули: Мобильное приложение: Переключение стилей темы множило макет MobileAppLayout. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: При создании товара из категории скрывалась возможность редактировать изображение. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: В блоке "Продавцы этого товара" ссылка в адресе продавца вела на страницу 404. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Возникала ошибка базы данных, если несколько продавцов одновременно начинали продажу общих товаров из одной и той же категории. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Импорт: При импорте общего товара изменения не применялись к товарным предложениям. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Общие товары не учитывали настройку "Показывать товары, которых нет в наличии". Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Премодерация данных продавцов: Общий товар не появлялся на витрине после одобрения его товарного предложения администратором. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Фильтры: Если у характеристик было много вариантов, то в панели администратора долго загружался список товаров, доступных для продажи. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Пометка о том, что товар со скидкой, не отображалась на списках товаров и на детальной странице общего товара на витрине. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Экспорт/Импорт: Созданный в процессе импорта товар присваивался новому продавцу с именем "~", если поле "Vendor" было последним в файле импорта. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Экспорт/Импорт: При экспорте "Товаров, которые можно продавать" экспортировались все товары в магазине. Исправлено.

[!] Multi-Vendor Plus: Модули: Оплата напрямую продавцам: При повторной оплате заказа на детальной странице покупатель мог увидеть способы оплаты, которые этот продавец не предлагает. Исправлено.

[!] Multi-Vendor Ultimate: Витрины: Валюты: Продавцы могли видеть валюты с витрин, на которые они не назначены. Исправлено.

===========
Сервис-паки
===========

----------
4.11.4.SP1
----------

[!] Модули: SEO: JSON-LD: Некоторые сторонние темы не могли работать с новой разметкой JSON-LD, а механизма использования старой разметки не было. Исправлено.

----------
4.11.4.SP2
----------

[!] Ядро: Установка и обновление, создание и восстановление резервных копий, импорт и экспорт, а также некоторые другие операции не работали в Google Chrome v83. Исправлено.

----------
4.11.4.SP3
----------

[+] Multi-Vendor: Модули: Яндекс.Касса: Добавлен процессор "Яндекс.Касса для платформ" со сплитованием платежей для маркетплейсов.

[!] Multi-Vendor: Emails: Администратор продавца после регистрации получал письмо с данными для входа, но в нём вместо логина для входа (email) был внутренний идентификатор пользователя. Исправлено.