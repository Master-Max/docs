*********
Robokassa
*********

Модуль позволяет принимать платежи через `Robokassa <https://robokassa.com/>`_, а также автоматичски разделять полученные средства между владельцем макретплейса и продавцами.

Функциональность
================

Включенный модуль позволяет создать способ оплаты "Робокасса" (доступен во всех редакциях CS-Cart) и "Робокасса с разделением платежей" (доступен только в CS-Cart для маркетплейсов). Любой из способов интегрирует ваш магазин/маркетплейс с Robokassa, таким образом вы сможете принимать платежи 26 способами оплаты, среди которых: банковские карты, онлайн-кошельки, бесконтактная оплата Yandex Pay, карты рассрочки.

Вот как работает разделение платежей для маркетплейсов (сплитование):

#. В панели администратора вы устанавливаете модуль Робокасса и настраиваете способ оплаты.

#. Покупатель на вашем маркетплейсе выбирает несколько товаров от разных продавцов и платит один раз.

#. Робокасса делит оплату и отправляет деньги каждому продавцу, а комиссию — платформе.

Настройка способа оплаты
========================

.. note:: 

    Перед настройкой способа оплаты в панели администратора, необходимо `зарегистрировать личный кабинет <http://partner.robokassa.ru>`_ и `подключить ваш маркетплейс к Robokassa <https://robokassa.com/content/nachalo-raboty.html>`_.

#. :doc:`В панели администратора установите модуль Robokassa </user_guide/addons/1manage_addons>`.

#. Перейдите на страницу **Администрирование → Способы оплаты** и добавьте новый способ оплаты, нажав **+** в правом верхнем углу. 

#. В появившемся окне на вкладке *Общее* выберите процессор. Процессор "Робокасса с разделением платежей [Beta]" подходит для маркетплейсов, которые хотят добавить поддержку сплитования. Вы также можете выбрать процессор "Робокасса" без сплитования. :doc:`Заполните остальные поля </user_guide/payment_methods/configure_payment>`. 

#. Перейдите на вкладку *Настроить*, где находятся технические настройки для вашего магазина в Робокассе. 

   4.1. Укажите данные из магазина/маркетплейса.

   * Скопируйте **Result URL**. 

   * `На странице "Мои магазины" <https://partner.robokassa.ru/Shops>`_ в личном кабинете Robokassa откройте настройки своего магазина и перейдите на вкладку *Технические настройки*. 

   * Вставьте скопированное в соответствующее поле. 

   * Укажите **Метод отсылки данных по Result Url** такой, как в вашем маркетпелйсе.

   * Повторите эти действия с полями **Success URL** и **Fail URL**.

   4.2. Укажите данные из Robokassa. 

   Из обязательных:

   * **Master store ID** / **Merchant ID** — **Идентификатор магазина** магазина в Robokassa;

   * **Пароль1** и **Пароль2**;

   * Выбор режима — **тестовый** или **рабочий**.

   Необязательное для заполнение поле **Номер счёта**, которое `Robokassa рекомендует всё же использовать <https://docs.robokassa.ru/script-parameters/#:~:text=%D0%B2%20%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%B5%20%D0%BE%D0%BF%D0%BB%D0%B0%D1%82%D1%8B.-,InvId,%D0%9D%D0%BE%D0%BC%D0%B5%D1%80%20%D1%81%D1%87%D0%B5%D1%82%D0%B0%20%D0%B2%20%D0%BC%D0%B0%D0%B3%D0%B0%D0%B7%D0%B8%D0%BD%D0%B5.,-%D0%9D%D0%B5%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9%20%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%2C%20%D0%BD%D0%BE>`_.

   4.3. Для владельцев CS-Cart для интернет-магазинов появляются дополнительные настройки.

   Добавьте **Описание**, которое будет отображаться в деталях платежа на странице оплаты в Робокассе. Укажите, с кого будет браться **Комиссия** за использования платежной системы Робокасса.

   Чтобы получить список доступных способов оплаты, заполните поле **Merchant ID** и нажмите кнопку "Получить способы оплаты" рядом с полем. Затем в поле **Способ оплаты** выберите приоритетный метод оплаты.

   В **Карте статусов заказа** укажите, какие статусы будут присваиваться заказам после оплаты.

#. Нажмите **Сохранить**.

.. fancybox:: img/lk.png
    :alt: Вкладка Технические настройки магазина в личном кабинете Robokassa.

.. fancybox:: img/creation.png
    :alt: Настройки способа оплаты в панели администратора.

Добавление продавцов
====================

Чтобы оплата и сплитование работали корректно, подключите продавцов к Robokassa. Для этого перейдите в профиль продавца, щелкнув по его названию на странице **Продавцы → Продавцы** в панели администратора. Откройте вкладку *Модули* и в разделе Robokassa укажите данные из технических настроек магазина в Robokassa (те же, что указывали при настройке способа оплаты): **ID магазина**, т.е. **Идентификатор магазина**, и **Номер счета**. Нажмите **Сохранить**.

Проверьте работу способа оплаты, создав тестовый заказ.

.. fancybox:: img/vendor.png
    :alt: Подключение продавца к Robokassa через его профиль.

